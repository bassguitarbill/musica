Basic idea
Roll 12 sided die to determine key
Roll 6 sided die several times to choose chords within the key. You can do this in several sets to have multiple keys to work with
Roll a die that chooses between some set of rhythmic cells (ie  1 is a half note, 2 is 2 quarter notes, 3 is a quarter rest and a quarter note, Etc). This string is the rhythm of the melody.
Roll a die that chooses from the 1,3,5,7,9, or 11th degree. These values are applied to the rhythm string, with the note chosen based on the chord it appears on (the result is that every pitch will be in the chord that it appears over). User can choose octave.

There's a million ways to vary this but I was trying to do something that might result in coherent music at the end

Oh and I would want this to output a midi file